# tyrano_jinro
『汝は人狼なりや？』をティラノスクリプト製のノベルゲームとして制作・プレイするためのプラグインやマクロ集、  
およびその実装例としてのサンプルゲームです。  
  
※まだ製作中なので利用はお控えください。  
完成の暁にはティラノスクリプト用プラグイン、マクロとして利用いただけるようにいたします。
  
# 動作確認バージョン
- Windows10
- ティラノスクリプト v520b(ver.0.4から)
- ティラノスタジオ v120(ver.0.4から)
  

# 更新履歴
- ver.0.5(20230116)
  - 投票フェイズで同票だった場合に再投票できるように。上限を越えたら引き分けにするように。
  - 議論フェイズ作成。
    - 議論によって信頼度が増減するように。
    - NPCが他キャラへの信頼度や同陣営可能性によって議論時のターゲットを選ぶように。
    - アクションボタン実装。
      - ロード後または`[awakegame]`を通るとゲーム変数`tyrano.plugin.kag.stat.f`が参照できなくなる仕様への対応のため、参照と書き込みは全て`TYRANO.kag.stat.f`を使うよう修正。
  - ボイボ人狼用glinkボタンのCSS作成。
    - ボタンオブジェクトおよびボタンオブジェクトからglinkを生成するサブルーチン作成。
    - 他のボタンも順次デフォルトのglinkから切り替えたい。
- ver.0.4(20221016)
  - サンプルゲームの方向性を決定。
    - キャラクター、メッセージマクロ、タイトル画面、フレームやボタン表示、フォント表示など実装（画像やフォントは非同梱）
  - キャラクターの入退場マクロを作成。
  - キャラクター選択ボタンへのマウスホバーでも入退場マクロを実行するようにした。
- ver.0.3(20220820)
  - 議論フェイズ用アクションボタンの仮実装。呼び出し箇所は未作成。
  - 視点の破綻後は、破綻したキャラの視点は共通視点オブジェクトで上書き、その他の視点は破綻したキャラを人狼陣営で更新するようにした。
    - プレイヤーの占い騙りによる破綻は未ブロック。扱いは同様でいいと思う。
  - 人狼メニュー画面を作成。占いCO結果を一覧表示できるように。
    - 人狼メニュー画面から戻ってからゲームを進行するとエラーになるバグあり。
    - 「ステータス画面」に改称予定。
  - 各キャラクターに信頼度オブジェクトを実装。
  - 投票ロジック実装。
- ver.0.2(20210704)
  - [messageマクロ](./data/scenario/messageMacros.ks)と[messageサブルーチン](data/scenario/message)にセリフやシステムメッセージを集約
  - [playJinro.ks](./data/scenario/playJinro.ks)（scene1.ksから名称変更）をリファクタリング。キャラクターIDに依存していた処理をほぼ脱却
  - PCの役職を選択できる画面を追加（将来のステージ選択機能の仮実装）
- ver.0.1(20210627)
  - ある程度動いたところで初版公開
  

# TODO
- [ ] COフェイズ
    - [ ] 信頼度計算をする
- [ ] COフェイズ中の視点整理とNPCのCO意思の計算タイミングの再考（カットインのタイミングに被せられるか？）  
- [ ] NPCの思考と行動の雛形制作  
  - [ ] 自分や仲間が破綻する騙りCOはしない
- [ ] 議論フェイズの制作  
  - [ ] アクションオブジェクトや定数をリファクタする
  - [x] アクション実行者の主張力を下げて、同日中は再発言しにくくする
  - [ ] 選択中のアクションボタンの色を変える
- [ ] 投票フェイズの制作  
  - [x] 投票結果画面を表示する
    - [x] メモ：お笑い番組の結果発表風はどうか。縦割りで画面下にキャラ絵、その上に投票先キャラ名で順々にスライドインしてくる感じ
  - [x] 投票結果テキストを表示する
  - [x] 内部処理する
    - [x] 信頼度計算をする
  - [x] 投票結果画面から戻る
  - [ ] キャラのセリフを表示、退場させる
- [ ] ステータス画面作成
- [ ] メニュー画面作成
- [x] ボタンを押させたくないときには消す
- [ ] 表情差分作る、差分表示しわける  
- [ ] ボイスを入れる
- [ ] BGM、演出を入れる
- [ ] バグ修正
  - [ ] PCが騙り占いで破綻すると例外エラーで止まる（修正可能）
  - [ ] 右側に表示中のキャラが再度発言する際、enterCharacter()で更に左へ移動するケースがある（時々起こるが再現性なし）
    - 夜にPCが占い対象に選んだNPCが、翌日最初にCOすると左へ移動した
  - [ ] キャラクター選択ボタン押下時にundefinedになりその後しばらくして止まることがある（クリックしまくってると起きやすい？）
  - [ ] アクションの第二階層ボタンにマウスをホバーさせるたびに、ボタンが増殖することがある（シナリオを進めずにアクションボタンを繰り返し押すとなる？）
- [ ] ゲームシナリオ作る
- [ ] 遊びの部分を作る
  - [ ] ステージ選択
  - [ ] 会話劇
  - [ ] アチーブメント
- [ ] 霊能者の実装（できれば）  
- [ ] 狩人の実装（できれば）  
- [ ] NPCの思考の強化学習（マジで言ってんの？）  
- [ ] ファイル構成の再検討  
  - [ ] マクロ.ksに記載するのはどうしてもティラノで書かないといけない内容だけにし、ロジックは可能な限りjs内に移植する
- [ ] docsやコメントの補完  
- [ ] リファクタリング  
  - [ ] iscript内のコメントを//にする
- [ ] アクションオブジェクトに関して
  - [ ] 議論だけでなく、占いやCOもアクションオブジェクトに集約できないか？
  - [ ] ヒストリーを残しておいたほうがよい？
- [ ] エラー調査用の実装
  - [ ] エラー発生時に全変数をファイル出力したい（ティラノ内にcatchしてる箇所がないか探す）

and more....
  

# 製作者
香取犬  
Twitter：[@catoriinu8190](https://twitter.com/catoriinu8190)  
ブログ：[ハイグレ郵便局 香取犬支店](http://highglepostoffice.blog.fc2.com/)  
  

# special thanks
[https://github.com/ShikemokuMK/tyranoscript](https://github.com/ShikemokuMK/tyranoscript)  
[https://webkatu.com/201407132011-clone-function-to-deepcopy-object/](https://webkatu.com/201407132011-clone-function-to-deepcopy-object/)  
[https://ameblo.jp/personwritep/entry-12495099049.html](https://ameblo.jp/personwritep/entry-12495099049.html)
